# chezmoi:template:left-delimiter="#{{" right-delimiter=}}
{ config
, lib
, pkgs
, ...
}:

rec {
  #region packages
  environment.systemPackages = [
    # plgs.cilium-cli
    pkgs.neovim
    pkgs.talosctl
  ] ++ (with pkgs.vimPlugins; [
    cmp-buffer
    cmp-cmdline
    cmp-nvim-lsp
    cmp-path
    cmp-treesitter
    completion-treesitter
    nvim-cmp
    nvim-lspconfig
    nvim-treesitter
    go-nvim
    vscode-nvim
  ]);

  homebrew.brews = [
    "cfengine"
    "snipkit"
  ];

  homebrew.casks = [
    "airbuddy"
    "airtable"
    "android-file-transfer"
    "android-platform-tools"
    "app-cleaner" # Nektony App Cleaner & Uninstaller
    "balenaetcher"
    "calibre"
    "chromium"
    "clickup"
    "daisydisk"
    "discord"
    "dropbox"
    "duckduckgo"
    "duet"
    "fluor"
    "hakuneko"
    "image2icon"
    "inkscape"
    "ivpn"
    "keybase"
    "kindle"
    "launchcontrol"
    "little-snitch"
    "macpass"
    "mactex-no-gui"
    "mate-translate"
    "messenger"
    "netnewswire"
    "onyx"
    "plex"
    "raspberry-pi-imager"
    "resilio-sync"
    "signal"
    "soundsource"
    "sqlitestudio"
    "steam"
    "telegram"
    "tiddly"
    "utm"
    "whatsapp@beta"
    "yattee"
    "yubico-yubikey-manager"
  ];

  homebrew.masApps = {
    "Apple Configurator" = 1037126344;
    "Be Focused Pro" = 961632517;
    "Just Press Record" = 1033342465;
    "Keynote" = 409183694;
    "Numbers" = 409203825;
    "OX Drive" = 818195014;
    "Parcel" = 639968404;
    "Privacy Redirect" = 1578144015;
    "Scenecuts Helper" = 1540491573;
    "SwiftoDo Desktop" = 1143641091;
    "TestFlight" = 899247664;
    "Xcode" = 497799835;
    # "Yubico Authenticator" = 1497506650;
  };

  homebrew.taps = [
    "lemoony/tap" # snipkit
  ];
  #endregion

  #region environment variables
  environment.variables = launchd.user.envVariables // {
    EMAIL = "#{{ .personal.email }}";
  };

  launchd.user.envVariables = {
    ENVIRONMENT = "home";
    PROJECTS_DIR = "$HOME/dev";
  };
  #endregion

  services.skhd.enable = false;

  system.defaults = {
    CustomUserPreferences = {
      "com.apple.mail" = {
        AddressesIncludeNameOnPasteboard = false;
        ConversationViewSortDescending = true;
        DisableInlineAttachmentViewing = true;
        DisableReplyAnimations = true;
        DisableSendAnimations = true;
        DraftsViewerAttributes = {
          DisplayInThreadedMode = "yes";
          SortedDescending = "no";
          SortOrder = "received-date";
        };
        NSUserKeyEquivalents = {
          Send = "@\\U21a9";
        };
        SpellCheckingBehavior = "NoSpellCheckingEnabled";
      };
      "com.apple.Safari" = {
        "com.apple.Safari.ContentPageGroupIdentifier.WebKit2AllowsInlineMediaPlayback" = false;
        "com.apple.Safari.ContentPageGroupIdentifier.WebKit2BackspaceKeyNavigationEnabled" = false;
        "com.apple.Safari.ContentPageGroupIdentifier.WebKit2DeveloperExtrasEnabled" = true;
        "com.apple.Safari.ContentPageGroupIdentifier.WebKit2HyperlinkAuditingEnabled" = false;
        "com.apple.Safari.ContentPageGroupIdentifier.WebKit2JavaEnabled" = false;
        "com.apple.Safari.ContentPageGroupIdentifier.WebKit2JavaEnabledForLocalFiles" = false;
        "com.apple.Safari.ContentPageGroupIdentifier.WebKit2JavaScriptCanOpenWindowsAutomatically" = false;
        "com.apple.Safari.ContentPageGroupIdentifier.WebKit2PluginsEnabled" = true;
        "com.apple.Safari.ContentPageGroupIdentifier.WebKit2TabsToLinks" = true;
        "WebKitPreferences.allowsPictureInPictureMediaPlayback" = true;
        "WebKitPreferences.applePayCapabilityDisclosureAllowed" = true;
        "WebKitPreferences.applePayEnabled" = true;
        "WebKitPreferences.developerExtrasEnabled" = true;
        "WebKitPreferences.hiddenPageDOMTimerThrottlingAutoIncreases" = true;
        "WebKitPreferences.invisibleMediaAutoplayNotPermitted" = true;
        "WebKitPreferences.javaScriptCanOpenWindowsAutomatically" = true;
        "WebKitPreferences.needsStorageAccessFromFileURLsQuirk" = false;
        "WebKitPreferences.pushAPIEnabled" = true;
        "WebKitPreferences.shouldAllowUserInstalledFonts" = false;
        "WebKitPreferences.shouldSuppressKeyboardInputDuringProvisionalNavigation" = true;
        AlwaysRestoreSessionAtLaunch = true;
        AlwaysShowTabBar = true;
        AutoFillCreditCardData = false;
        AutoFillFromAddressBook = false;
        AutoFillFromiCloudKeychain = false;
        AutoFillMiscellaneousForms = false;
        AutoFillPasswords = false;
        AutoOpenSafeDownloads = false;
        CanPromptForPushNotifications = false;
        Command1Through9SwitchesTabs = false;
        CommandClickMakesTabs = true;
        DebugSnapshotsUpdatePolicy = 2;
        DownloadsClearingPolicy = 0;
        ExtensionsEnabled = true;
        FindOnPageMatchesWordStartsOnly = false;
        HomePage = "";
        IncludeDevelopMenu = true;
        IncludeInternalDebugMenu = true;
        InstallExtensionUpdatesAutomatically = true;
        NewTabBehavior = 4;
        NewWindowBehavior = 4;
        OpenNewTabsInFront = false;
        PreloadTopHit = false;
        ProxiesInBookmarksBar = [];
        ReadingListSaveArticlesOfflineAutomatically = false;
        SearchProviderShortName = "DuckDuckGo";
        SendDoNotTrackHTTPHeader = false;
        ShowCloudTabsInFavorites = false;
        ShowFavoritesBar = true;
        ShowFrequentlyVisitedSites = false;
        ShowFullURLInSmartSearchField = true;
        ShowHighlightsInFavorites = false;
        ShowIconsInTabs = true;
        ShowPrivacyReportInFavorites = false;
        ShowReadingListInFavorites = false;
        ShowRecentlyClosedTabsPreferenceKey = false;
        ShowSidebarInNewWindows = false;
        ShowSidebarInTopSites = true;
        ShowSiriSuggestionsPreference = false;
        ShowTabGroupFavoritesPreferenceKey = false;
        SuppressSearchSuggestions = true;
        UniversalSearchEnabled = false;
        WarnAboutFraudulentWebsites = false;
        WebAutomaticSpellingCorrectionEnabled = false;
        WebContinuousSpellCheckingEnabled = true;
        WebKitDeveloperExtrasEnabledPreferenceKey = true;
        WebKitInitialTimedLayoutDelay = 0.25;
        WebKitJavaEnabled = false;
        WebKitJavaScriptCanOpenWindowsAutomatically = false;
        WebKitMediaPlaybackAllowsInline = false;
        WebKitPluginsEnabled = true;
        WebKitRespectStandardStyleKeyEquivalents = true;
        WebKitStorageBlockingPolicy = 1;
        WebKitTabToLinksPreferenceKey = true;
        WebsiteSpecificSearchEnabled = false;
      };
    };
    CustomSystemPreferences = {
      "/Library/Preferences/com.apple.TimeMachine" = {
        AutoBackup = true;
        AutoBackupInterval = 86400;
        ExcludeByPath = [];
        # MobileBackups = false;
        RequiresACPower = true;
        SkipPaths = [
          "~/Applications"
          "~/Cloud"
          "~/Desktop"
          "~/dev"
          "~/Downloads"
          "~/go"
          "~/Zotero"
        ];
      };
    };
    loginwindow = {
      LoginwindowText = ''
        Found this? Please contact me on #{{ .personal.email }} or #{{ .personal.mobile }}
      '';
    };
  };

  time.timeZone = "Europe/Amsterdam";
}
